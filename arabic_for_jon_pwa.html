<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arabic for Jon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111827" />

  <style>
    :root {
      --bg: #f3f4f6;
      --fg: #111827;
      --fg-muted: #6b7280;
      --card-bg: #ffffff;
      --card-border: rgba(15,23,42,0.08);
      --pill-bg: rgba(15,23,42,0.04);
      --pill-border: rgba(15,23,42,0.08);
      --control-bg: rgba(15,23,42,0.03);
      --control-border: rgba(15,23,42,0.12);
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,0.09);
      --known: #16a34a;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at 0% 0%, #e0f2fe 0, #f9fafb 55%, #e5e7eb 100%);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
    }

    body.theme-minimal {
      background: #f5f5f5;
      --accent: #111827;
      --accent-soft: rgba(17,24,39,0.07);
    }

    body.theme-colorful {
      background: radial-gradient(circle at 10% 0%, #fee2e2 0, #eff6ff 32%, #ecfdf5 65%, #fdf2ff 100%);
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,0.09);
    }

    body.theme-dark {
      background: radial-gradient(circle at 0 0, #1f2937 0, #020617 55%, #000000 100%);
      --bg: #020617;
      --fg: #e5e7eb;
      --fg-muted: #9ca3af;
      --card-bg: #020617;
      --card-border: rgba(148,163,184,0.3);
      --pill-bg: rgba(15,23,42,0.7);
      --pill-border: rgba(148,163,184,0.4);
      --control-bg: rgba(15,23,42,0.85);
      --control-border: rgba(148,163,184,0.4);
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.16);
    }

    .app-shell {
      max-width: 440px;
      margin: 12px auto 24px;
      padding: 16px 14px 18px;
      border-radius: 28px;
      background: rgba(249,250,251,0.96);
      box-shadow:
        0 24px 60px rgba(15,23,42,0.35),
        0 0 0 1px rgba(148,163,184,0.35);
      backdrop-filter: blur(18px);
    }
    body.theme-dark .app-shell {
      background: rgba(15,23,42,0.94);
      box-shadow:
        0 24px 60px rgba(0,0,0,0.8),
        0 0 0 1px rgba(30,64,175,0.5);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    header h1 {
      margin: 0;
      font-size: 1.35rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .counter {
      font-size: 0.7rem;
      color: var(--fg-muted);
    }
    .streak {
      font-size: 0.74rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(37,99,235,0.2);
      white-space: nowrap;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--fg-muted);
      cursor: pointer;
    }
    .tab.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 600;
    }

    .filters-row {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    .filters-row > div {
      flex: 0 0 auto;
      min-width: 90px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .filters-row label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--fg-muted);
    }
    .filters-row select,
    .filters-row input {
      background: var(--control-bg);
      border-radius: 999px;
      border: 1px solid var(--control-border);
      padding: 4px 10px;
      font-size: 0.8rem;
      color: var(--fg);
    }

    #cards-view {
      margin-bottom: 10px;
    }

    .card {
      position: relative;
      border-radius: 24px;
      border: 1px solid var(--card-border);
      background: radial-gradient(circle at 0% 0%, rgba(59,130,246,0.08) 0, rgba(249,250,251,0.98) 35%, rgba(248,250,252,1) 100%);
      padding: 18px 16px 22px;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      cursor: pointer;
      overflow: hidden;
    }
    body.theme-dark .card {
      background: radial-gradient(circle at 0% 0%, rgba(56,189,248,0.18) 0, #020617 45%, #020617 100%);
    }

    .pill {
      position: absolute;
      top: 10px;
      left: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      background: var(--pill-bg);
      border: 1px solid var(--pill-border);
      font-size: 0.7rem;
      color: var(--fg-muted);
    }
    .side-label {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--fg-muted);
    }
    .known-pill {
      position: absolute;
      bottom: 10px;
      right: 12px;
      font-size: 0.7rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(22,163,74,0.12);
      border: 1px solid rgba(22,163,74,0.8);
      color: var(--known);
    }

    #card-content {
      text-align: center;
      padding: 10px 6px;
    }

    .english {
      font-size: 1.4rem;
      font-weight: 600;
    }
    .arabic {
      font-size: 1.8rem;
      direction: rtl;
      font-family: -apple-system, system-ui, "SF Arabic", "Geeza Pro", Arial, sans-serif;
    }
    .translit {
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--fg-muted);
    }

    .hint {
      margin-top: 4px;
      font-size: 0.75rem;
      color: var(--fg-muted);
      text-align: center;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 8px;
    }
    .controls button {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--control-border);
      background: var(--control-bg);
      padding: 8px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--fg);
    }
    .controls button.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      font-weight: 600;
    }
    .controls button.small {
      flex: 0 0 auto;
      padding-inline: 12px;
    }

    /* List view */
    #list-view {
      display: none;
      border-radius: 18px;
      border: 1px solid var(--card-border);
      background: var(--control-bg);
      padding: 10px 10px 6px;
      max-height: 360px;
      flex-direction: column;
      gap: 8px;
    }
    .list-controls {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 0.8rem;
    }
    .list-controls select,
    .list-controls input {
      background: var(--control-bg);
      border-radius: 999px;
      border: 1px solid var(--control-border);
      padding: 4px 10px;
      font-size: 0.8rem;
      color: var(--fg);
    }
    .list-body {
      margin-top: 6px;
      overflow-y: auto;
      max-height: 260px;
      padding-right: 2px;
    }
    .list-item {
      padding: 6px 8px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      margin-bottom: 4px;
      background: var(--card-bg);
      display: flex;
      flex-direction: column;
      gap: 2px;
      cursor: pointer;
    }
    .list-row-main {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }
    .list-en {
      font-size: 0.95rem;
      font-weight: 600;
    }
    .list-ar {
      font-size: 1.1rem;
      direction: rtl;
      font-family: -apple-system, "SF Arabic", "Geeza Pro", Arial, sans-serif;
    }
    .list-tr {
      font-size: 0.8rem;
      color: var(--fg-muted);
    }
    .list-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--fg-muted);
      margin-top: 2px;
    }
    body.theme-dark .list-item {
      background: #111827;
      border-color: rgba(255,255,255,0.1);
    }
    body.theme-dark .list-en,
    body.theme-dark .list-ar,
    body.theme-dark .list-tr {
      color: #f3f4f6;
    }

    .badge-category {
      display: inline-block;
      padding: 2px 8px;
      font-size: 0.65rem;
      border-radius: 999px;
      background: var(--pill-bg);
      border: 1px solid var(--pill-border);
      color: var(--fg-muted);
      margin-right: 6px;
    }
    .badge-known {
      display: inline-block;
      padding: 2px 8px;
      font-size: 0.65rem;
      border-radius: 999px;
      background: rgba(21,128,61,0.12);
      border: 1px solid var(--known);
      color: var(--known);
    }

    /* Quiz */
    #quiz-view {
      display: none;
    }
    .quiz-panel {
      margin-top: 6px;
      border-radius: 18px;
      border: 1px solid var(--card-border);
      background: var(--control-bg);
      padding: 14px 12px;
      display: none;
      flex-direction: column;
      gap: 8px;
    }
    .quiz-question {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .quiz-option {
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--control-bg);
      border: 1px solid var(--control-border);
      cursor: pointer;
      font-size: 1rem;
      color: var(--fg);
    }
    .quiz-option.correct {
      background: rgba(21,128,61,0.2);
      border-color: #15803d;
    }
    .quiz-option.wrong {
      background: rgba(185,28,28,0.2);
      border-color: #b91c1c;
    }
    .quiz-meta {
      font-size: 0.75rem;
      color: var(--fg-muted);
      display: flex;
      justify-content: space-between;
    }

    /* Study tools */
    #study-tools-view {
      display: none;
      flex-direction: column;
      gap: 14px;
      padding: 6px;
      border-radius: 18px;
      border: 1px solid var(--card-border);
      background: var(--control-bg);
    }

    .subtabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }
    .subtab {
      flex: 1;
      padding: 6px;
      text-align: center;
      border-radius: 999px;
      border: 1px solid var(--control-border);
      background: var(--control-bg);
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--fg-muted);
    }
    .subtab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    #letters-table,
    #conjugation-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 4px;
    }
    #letters-table th,
    #letters-table td,
    #conjugation-table th,
    #conjugation-table td {
      border-bottom: 1px solid var(--card-border);
      padding: 6px 4px;
    }
    #letters-table th,
    #conjugation-table th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--fg-muted);
      text-align: left;
    }
    .letters-arabic,
    .letters-printed {
      direction: rtl;
      font-family: -apple-system, "SF Arabic", "Geeza Pro", Arial, sans-serif;
      font-size: 1.1rem;
    }

    /* Conjugation table specifics */
    #conjugation-table td.pattern {
      direction: ltr;
      text-align: left;
      font-size: 1.05rem;
      font-family: -apple-system, "SF Arabic", "Geeza Pro", Arial, sans-serif;
    }
    #conjugation-table td.pronoun {
      direction: rtl;
      text-align: right;
      font-family: -apple-system, "SF Arabic", "Geeza Pro", Arial, sans-serif;
      font-size: 1.05rem;
    }

    /* Theme selector */
    .theme-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 8px;
      font-size: 0.75rem;
    }
    .theme-label {
      color: var(--fg-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .theme-buttons {
      display: flex;
      gap: 4px;
    }
    .theme-btn {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--control-border);
      background: var(--control-bg);
      font-size: 0.72rem;
      cursor: pointer;
      color: var(--fg-muted);
    }
    .theme-btn.theme-active {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
      font-weight: 600;
    }

    footer {
      margin-top: 10px;
      font-size: 0.7rem;
      color: var(--fg-muted);
      text-align: right;
    }
  </style>
</head>
<body class="theme-colorful">
  <div class="app-shell">
    <header>
      <div>
        <h1>Levantine Arabic</h1>
        <span id="counter" class="counter"></span>
      </div>
      <div class="streak" id="streak-label">üî• 0-day streak</div>
    </header>

    <!-- FILTERS -->
    <div class="filters-row">
      <div>
        <label for="filter-category">Category</label>
        <select id="filter-category"></select>
      </div>
      <div>
        <label for="filter-status">Show</label>
        <select id="filter-status">
          <option value="all">All</option>
          <option value="unknown">Unknown</option>
          <option value="known">Known</option>
        </select>
      </div>
      <div style="flex:1; min-width:140px;">
        <label for="filter-search">Search</label>
        <input id="filter-search" placeholder="English‚Ä¶" />
      </div>
    </div>

    <!-- MAIN TABS -->
    <div class="tabs">
      <div class="tab active" id="tab-cards">Cards</div>
      <div class="tab" id="tab-list">List</div>
      <div class="tab" id="tab-quiz">Quiz</div>
      <div class="tab" id="tab-study">Study Tools</div>
    </div>

    <!-- CARDS VIEW -->
    <div id="cards-view">
      <div id="card" class="card">
        <div class="pill" id="category-pill"></div>
        <div class="side-label" id="side-label">Front ¬∑ EN</div>
        <div id="known-pill" class="known-pill" style="display:none;">Known</div>
        <div id="card-content"></div>
        <div class="hint" id="hint-text">
          Tap left = prev ¬∑ middle = flip ¬∑ right = next
        </div>
      </div>

      <div class="controls">
        <button id="prev-btn">‚üµ Prev</button>
        <button id="flip-btn" class="primary">Flip</button>
        <button id="next-btn">Next ‚ü∂</button>
      </div>

      <div class="controls">
        <button id="toggle-known-btn" class="small">Mark Known</button>
        <button id="shuffle-btn" class="small">Shuffle üîÄ</button>
      </div>
    </div>

    <!-- LIST VIEW -->
    <div id="list-view">
      <div class="list-controls">
        <select id="list-category-filter"></select>
        <input id="list-search" placeholder="Search English..." />
      </div>
      <div class="list-body" id="list-body"></div>
    </div>

    <!-- QUIZ VIEW -->
    <div id="quiz-view">
      <div class="quiz-panel" id="quiz-panel">
        <div class="quiz-question" id="quiz-question"></div>
        <div class="quiz-options" id="quiz-options"></div>
        <div class="quiz-meta">
          <span id="quiz-progress"></span>
          <span id="quiz-result"></span>
        </div>
      </div>
      <div class="controls">
        <button id="start-quiz-btn" class="primary small">Start</button>
        <button id="reset-quiz-btn" class="small">Reset</button>
      </div>
    </div>

    <!-- STUDY TOOLS -->
    <div id="study-tools-view">
      <div class="subtabs">
        <div class="subtab active" id="subtab-letters">Letters</div>
        <div class="subtab" id="subtab-conjugation">Conjugation</div>
      </div>

      <!-- LETTERS -->
      <div id="letters-view">
        <table id="letters-table"></table>
      </div>

      <!-- CONJUGATION -->
      <div id="conjugation-view" style="display:none;">
        <table id="conjugation-table">
          <thead>
            <tr>
              <th>Verb 2</th>
              <th>Verb 1</th>
              <th>Pronoun</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="pattern">‚Äî‚Äî‚Äî</td>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ®</td>
              <td class="pronoun">ÿ£ŸÜÿß</td>
            </tr>
            <tr>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ™</td>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ®ÿ™</td>
              <td class="pronoun">ÿ•ŸÜÿ™Ÿé</td>
            </tr>
            <tr>
              <td class="pattern"> ÿ™ ‚Äî‚Äî‚Äî Ÿä</td>
              <td class="pattern"> ÿ®ÿ™ ‚Äî‚Äî‚Äî Ÿä</td>
              <td class="pronoun">ÿ•ŸÜÿ™Ÿä / ÿ•ŸÜÿ™Ÿê</td>
            </tr>
            <tr>
              <td class="pattern">‚Äî‚Äî‚Äî Ÿä</td>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ®Ÿä</td>
              <td class="pronoun">ŸáŸà</td>
            </tr>
            <tr>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ™</td>
              <td class="pattern">‚Äî‚Äî‚Äî ÿ®ÿ™</td>
              <td class="pronoun">ŸáŸä</td>
            </tr>
            <tr>
              <td class="pattern">‚Äî‚Äî‚Äî ŸÜ</td>
              <td class="pattern">‚Äî‚Äî‚Äî ŸÖŸÜ</td>
              <td class="pronoun">ŸÜÿ≠ŸÜÿß</td>
            </tr>
            <tr>
              <td class="pattern">ÿ™ ‚Äî‚Äî‚Äî Ÿà</td>
              <td class="pattern"> ÿ®ÿ™ ‚Äî‚Äî‚ÄîŸà</td>
              <td class="pronoun">ÿ•ŸÜÿ™Ÿà</td>
            </tr>
            <tr>
              <td class="pattern"> Ÿä ‚Äî‚Äî‚ÄîŸà</td>
              <td class="pattern">ÿ®Ÿä ‚Äî‚Äî‚Äî Ÿà</td>
              <td class="pronoun">ŸáŸÜŸëŸä</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- THEME SELECTOR -->
    <div class="theme-row">
      <div class="theme-label">Appearance</div>
      <div class="theme-buttons">
        <button type="button" class="theme-btn" data-theme="minimal">Minimal</button>
        <button type="button" class="theme-btn" data-theme="colorful">Colorful</button>
        <button type="button" class="theme-btn" data-theme="dark">Dark</button>
      </div>
    </div>

    <footer>Progress saved locally</footer>
  </div>

  <script>
    /* ---------- VOCAB CARDS ---------- */
    const cards = [
      /* Days */
      { category:"Days", front:"Sunday", arabic:"ÿßŸÑÿ£ÿ≠ÿØ", translit:"el-a·∏•ad" },
      { category:"Days", front:"Monday", arabic:"ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ", translit:"et-tnein" },
      { category:"Days", front:"Tuesday", arabic:"ÿßŸÑÿ™ŸÑÿßÿ™ÿß", translit:"et-talƒÅta" },
      { category:"Days", front:"Wednesday", arabic:"ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°", translit:"el-arbƒÅ ø" },
      { category:"Days", front:"Thursday", arabic:"ÿßŸÑÿÆŸÖŸäÿ≥", translit:"el-khamƒ´s" },
      { category:"Days", front:"Friday", arabic:"ÿßŸÑÿ¨ŸÖÿπÿ©", translit:"el-jom øa" },
      { category:"Days", front:"Saturday", arabic:"ÿßŸÑÿ≥ÿ®ÿ™", translit:"es-sabt" },

      /* Time words */
      { category:"Time Words", front:"today", arabic:"ÿßŸÑŸäŸàŸÖ", translit:"elyom" },
      { category:"Time Words", front:"tomorrow", arabic:"ÿ®ŸÉÿ±ÿß", translit:"bukra" },
      { category:"Time Words", front:"day after tomorrow", arabic:"ÿ®ÿπÿØ ÿ®ŸÉÿ±ÿß", translit:"baad bukra" },
      { category:"Time Words", front:"yesterday", arabic:"ŸÖÿ®ÿßÿ±ÿ≠", translit:"mbarah" },
      { category:"Time Words", front:"day before yesterday", arabic:"ŸÇÿ®ŸÑ ŸÖÿ®ÿßÿ±ÿ≠", translit:"abl mbarah" },
      { category:"Time Words", front:"now", arabic:"ŸáŸÑŸëŸÇ", translit:"halla" },

      /* Time of day */
      { category:"Time of Day", front:"in the morning", arabic:"ÿßŸÑÿµÿ®ÿ≠", translit:"es-sobh" },
      { category:"Time of Day", front:"at noon", arabic:"ÿßŸÑÿ∏Ÿáÿ±", translit:"ez-zohor" },
      { category:"Time of Day", front:"in the afternoon", arabic:"ÿ®ÿπÿØ ÿßŸÑÿ∏Ÿáÿ±", translit:"baad ez-zohor" },
      { category:"Time of Day", front:"afternoon (alt.)", arabic:"ÿßŸÑÿπÿµÿ±", translit:"el- øasr" },
      { category:"Time of Day", front:"in the evening", arabic:"ÿßŸÑŸÖÿ≥ÿß", translit:"el-masa" },
      { category:"Time of Day", front:"at night", arabic:"ÿ®ÿßŸÑŸÑŸäŸÑ", translit:"bel-leel" },
      { category:"Time of Day", front:"dawn", arabic:"ÿßŸÑŸÅÿ¨ÿ±", translit:"el-fajr" },
      { category:"Time of Day", front:"early morning", arabic:"Ÿàÿ¥Ÿë ÿßŸÑÿµÿ®ÿ≠", translit:"wesh es-sobh" },

      /* Seasons */
      { category:"Seasons", front:"summer", arabic:"ÿßŸÑÿµŸäŸÅ", translit:"es-seif" },
      { category:"Seasons", front:"winter", arabic:"ÿßŸÑÿ¥ÿ™ÿß", translit:"esh-sheta" },
      { category:"Seasons", front:"spring", arabic:"ÿßŸÑÿ±ÿ®Ÿäÿπ", translit:"er-rabi ø" },
      { category:"Seasons", front:"fall / autumn", arabic:"ÿßŸÑÿÆÿ±ŸäŸÅ", translit:"el-khareef" },

      /* Weather */
      { category:"Weather", front:"weather (formal)", arabic:"ÿßŸÑÿ∑ŸÇÿ≥", translit:"et-ta ºes" },
      { category:"Weather", front:"weather (casual)", arabic:"ÿßŸÑÿ¨Ÿà", translit:"el-jaww" },
      { category:"Weather", front:"nice / pleasant", arabic:"ÿ≠ŸÑŸà", translit:"helou" },
      { category:"Weather", front:"not nice", arabic:"ŸÖÿ¥ ÿ≠ŸÑŸà", translit:"mesh helou" },
      { category:"Weather", front:"very", arabic:"ŸÉÿ™Ÿäÿ±", translit:"kteer" },
      { category:"Weather", front:"hot (weather)", arabic:"ÿ¥Ÿàÿ®", translit:"shob" },
      { category:"Weather", front:"cold (weather)", arabic:"ÿ®ÿ±ÿØ", translit:"bard" },
      { category:"Weather", front:"warm", arabic:"ÿØÿßŸÅŸä", translit:"dafi" },
      { category:"Weather", front:"sunny", arabic:"ŸÖÿ¥ŸÖÿ≥", translit:"mshammes" },
      { category:"Weather", front:"cloudy", arabic:"ŸÖÿ∫ŸäŸÖ", translit:"mghayyem" },
      { category:"Weather", front:"rainy", arabic:"ŸÖŸÖÿ∑ÿ±", translit:"momter" },
      { category:"Weather", front:"snowy", arabic:"ŸÖŸíÿ™ŸÑŸëÿ¨", translit:"mtallij" },
      { category:"Weather", front:"sun", arabic:"ÿ¥ŸÖÿ≥", translit:"shames" },
      { category:"Weather", front:"rain", arabic:"ŸÖÿ∑ÿ±", translit:"matar" },
      { category:"Weather", front:"snow", arabic:"ÿ™ŸÑÿ¨", translit:"talj" },
      { category:"Weather", front:"wind / air", arabic:"ŸáŸàÿß", translit:"hawa" },

      /* Introductions */
      { category:"Introductions", front:"What is your name? (m)", arabic:"ÿ¥Ÿà ÿßÿ≥ŸÖŸÉÿü", translit:"shoo esmak?" },
      { category:"Introductions", front:"What is your name? (f)", arabic:"ÿ¥Ÿà ÿßÿ≥ŸÖŸêŸÉÿü", translit:"shoo esmik?" },
      { category:"Introductions", front:"My name is Ali", arabic:"ÿßÿ≥ŸÖŸä ÿπŸÑŸä", translit:"esme Ali" },
      { category:"Introductions", front:"How old are you?", arabic:"ŸÇÿØŸëŸäÿ¥ ÿπŸÖÿ±ŸÉÿü", translit:"addeesh omrak?" },
      { category:"Introductions", front:"I am 10", arabic:"ÿ£ŸÜÿß ÿπÿ¥ÿ±ÿ©", translit:"ana  øashra" },
      { category:"Introductions", front:"Where are you from? (m)", arabic:"ŸÖŸÜ ÿ£ŸäŸë ÿ®ŸÑÿØ ÿ•ŸÜÿ™ÿü", translit:"men ayya balad enta" },
      { category:"Introductions", front:"Where are you from? (f)", arabic:"ŸÖŸÜ ÿ£ŸäŸë ÿ®ŸÑÿØ ÿ•ŸÜÿ™Ÿêÿü", translit:"men ayya balad ente" },
      { category:"Introductions", front:"I am from Germany", arabic:"ÿ£ŸÜÿß ŸÖŸÜ ÿ£ŸÑŸÖÿßŸÜŸäÿß", translit:"ana men Almaniya" },

      /* Pronouns */
      { category:"Pronouns", front:"I", arabic:"ÿ£ŸÜÿß", translit:"ana" },
      { category:"Pronouns", front:"you (m)", arabic:"ÿ•ŸÜÿ™", translit:"enta" },
      { category:"Pronouns", front:"you (f)", arabic:"ÿ•ŸÜÿ™Ÿê", translit:"ente" },
      { category:"Pronouns", front:"he", arabic:"ŸáŸà", translit:"howwe" },
      { category:"Pronouns", front:"she", arabic:"ŸáŸä", translit:"heyye" },
      { category:"Pronouns", front:"we", arabic:"ŸÜÿ≠ŸÜÿß", translit:"nehna" },
      { category:"Pronouns", front:"you (pl)", arabic:"ÿ•ŸÜÿ™Ÿà", translit:"ento" },
      { category:"Pronouns", front:"they", arabic:"ŸáŸÜŸä", translit:"henne" },

      /* Have */
      { category:"Have", front:"I have", arabic:"ÿπŸÜÿØŸä", translit:"andi" },
      { category:"Have", front:"you have (m)", arabic:"ÿπŸÜÿØŸÉ", translit:"andak" },
      { category:"Have", front:"you have (f)", arabic:"ÿπŸÜÿØŸêŸÉ", translit:"andek" },
      { category:"Have", front:"he has", arabic:"ÿπŸÜÿØŸà", translit:"ando" },
      { category:"Have", front:"she has", arabic:"ÿπŸÜÿØÿß", translit:"anda" },
      { category:"Have", front:"we have", arabic:"ÿπŸÜÿØŸÜÿß", translit:"andna" },
      { category:"Have", front:"you (pl) have", arabic:"ÿπŸÜÿØŸÉŸÜ", translit:"andkon" },
      { category:"Have", front:"they have", arabic:"ÿπŸÜÿØŸÜ", translit:"andon" },

      /* Question words */
      { category:"Questions", front:"what?", arabic:"ÿ¥Ÿàÿü", translit:"shoo?" },
      { category:"Questions", front:"how?", arabic:"ŸÉŸäŸÅÿü", translit:"keef?" },
      { category:"Questions", front:"where?", arabic:"ŸàŸäŸÜÿü", translit:"ween?" },
      { category:"Questions", front:"when?", arabic:"ÿ•ŸÖÿ™Ÿâÿü", translit:"emta?" },
      { category:"Questions", front:"why?", arabic:"ŸÑŸäÿ¥ÿü", translit:"lesh?" },
      { category:"Questions", front:"who?", arabic:"ŸÖŸäŸÜÿü", translit:"meen?" },
      { category:"Questions", front:"how much / how many?", arabic:"ŸÇÿØŸëŸäÿ¥ÿü", translit:"addeesh?" },
      { category:"Questions", front:"is there / there is?", arabic:"ŸÅŸäÿü", translit:"fi?" },

      /* Numbers 0‚Äì12 */
      { category:"Numbers", front:"0 ‚Äî zero", arabic:"ÿµŸÅÿ±", translit:"sefr" },
      { category:"Numbers", front:"1 ‚Äî one", arabic:"Ÿàÿßÿ≠ÿØ", translit:"wahed" },
      { category:"Numbers", front:"2 ‚Äî two", arabic:"ÿ™ŸÜŸéŸäŸÜ", translit:"tnene" },
      { category:"Numbers", front:"3 ‚Äî three", arabic:"ÿ™ŸÑÿßÿ™ÿ©", translit:"tleete" },
      { category:"Numbers", front:"4 ‚Äî four", arabic:"ÿ£ÿ±ÿ®ÿπÿ©", translit:"arba øa" },
      { category:"Numbers", front:"5 ‚Äî five", arabic:"ÿÆŸÖÿ≥ÿ©", translit:"khemse" },
      { category:"Numbers", front:"6 ‚Äî six", arabic:"ÿ≥ÿ™Ÿëÿ©", translit:"sette" },
      { category:"Numbers", front:"7 ‚Äî seven", arabic:"ÿ≥ÿ®ÿπÿ©", translit:"seba ø" },
      { category:"Numbers", front:"8 ‚Äî eight", arabic:"ÿ™ŸÖÿßŸÜÿ©", translit:"tmaneh" },
      { category:"Numbers", front:"9 ‚Äî nine", arabic:"ÿ™ÿ≥ÿπÿ©", translit:"tesa ø" },
      { category:"Numbers", front:"10 ‚Äî ten", arabic:"ÿπÿ¥ÿ±ÿ©", translit:" øashra" },
      { category:"Numbers", front:"11 ‚Äî eleven", arabic:"ÿ≠ÿØÿπÿ¥", translit:"hda øsh" },
      { category:"Numbers", front:"12 ‚Äî twelve", arabic:"ÿ∑ŸÜŸéÿπÿ¥", translit:"tna øsh" },

      /* Time numbers */
      { category:"Numbers (Time)", front:"one (time)", arabic:"Ÿàÿ≠ÿØÿ©", translit:"wa·∏•de" },
      { category:"Numbers (Time)", front:"two (time)", arabic:"ÿ™ŸÜÿ™ŸäŸÜ", translit:"tntein" },

      /* Telling time (minutes) */
      { category:"Telling Time", front:"5 minutes", arabic:"ÿÆŸÖÿ≥ÿ©", translit:"khemse" },
      { category:"Telling Time", front:"10 minutes", arabic:"ÿπÿ¥ÿ±ÿ©", translit:" øashra" },
      { category:"Telling Time", front:"15 (quarter)", arabic:"ÿ±ÿ®ÿπ", translit:"rebe ø" },
      { category:"Telling Time", front:"20 (third)", arabic:"ÿ™ŸÑÿ™", translit:"telt" },
      { category:"Telling Time", front:"25", arabic:"ÿ™ŸÑÿ™ ŸàÿÆŸÖÿ≥ÿ©", translit:"telt w khemse" },
      { category:"Telling Time", front:"30 (half)", arabic:"ŸÜÿµ", translit:"noss" },
      { category:"Telling Time", front:"35", arabic:"ÿÆŸÖÿ≥ÿ© Ÿàÿ™ŸÑÿ™", translit:"khemse w telt" },
      { category:"Telling Time", front:"40", arabic:"ÿ•ŸÑÿß ÿ™ŸÑÿ™", translit:"ella telt" },
      { category:"Telling Time", front:"45", arabic:"ÿ•ŸÑÿß ÿ±ÿ®ÿπ", translit:"ella rebe ø" },
      { category:"Telling Time", front:"50", arabic:"ÿ•ŸÑÿß ÿπÿ¥ÿ±ÿ©", translit:"ella  øashra" },
      { category:"Telling Time", front:"7:40", arabic:"ÿ™ŸÖÿßŸÜÿ© ÿ•ŸÑÿß ÿ™ŸÑÿ™", translit:"tmaneh ella telt" },

      /* Small talk */
      { category:"Small Talk", front:"What's up? / What's the news?", arabic:"ÿ¥Ÿà ÿßŸÑÿ£ÿÆÿ®ÿßÿ±ÿü", translit:"shoo l-akhbar?" },
      { category:"Small Talk", front:"Nothing new", arabic:"ŸÖÿß ŸÅŸä ÿ¥Ÿä ÿ¨ÿØŸäÿØ", translit:"ma fi shi jdeed" },

      /* Misc */
      { category:"Misc", front:"number", arabic:"ÿ±ŸÇŸÖ", translit:"ra ºam" },
      { category:"Misc", front:"numbers", arabic:"ÿ£ÿ±ŸÇÿßŸÖ", translit:"ar ºaam" },

      /* Family basic */
      { category:"Family", front:"family", arabic:"ÿπŸäŸÑÿ©", translit:"3ayle" },
      { category:"Family", front:"parents", arabic:"ÿ£ŸáŸÑ", translit:"ahl" },
      { category:"Family", front:"mother", arabic:"ŸàÿßŸÑÿØÿ©", translit:"walid√©" },
      { category:"Family", front:"father", arabic:"ŸàÿßŸÑÿØ", translit:"walid" },
      { category:"Family", front:"mom", arabic:"ŸÖÿßŸÖÿß", translit:"mama" },
      { category:"Family", front:"dad", arabic:"ÿ®ÿßÿ®ÿß", translit:"baba" },
      { category:"Family", front:"my mom", arabic:"ÿ£ŸÖŸä", translit:"ommi" },
      { category:"Family", front:"my dad", arabic:"ÿ£ÿ®Ÿä / ÿ®ŸäŸëŸä", translit:"abbi / bayyi" },
      { category:"Family", front:"son", arabic:"ÿßÿ®ŸÜ", translit:"ebin" },
      { category:"Family", front:"daughter", arabic:"ÿ®ŸÜÿ™", translit:"bent" },
      { category:"Family", front:"wife", arabic:"ŸÖÿ±ÿ™ / ÿ≤Ÿàÿ¨ÿ©", translit:"marat / zauj√©" },
      { category:"Family", front:"husband", arabic:"ÿ≤Ÿàÿ¨ / ÿ¨Ÿàÿ≤", translit:"zauj / jouz" },
      { category:"Family", front:"brother", arabic:"ÿ£ÿÆ", translit:"ekh" },
      { category:"Family", front:"sister", arabic:"ÿ£ÿÆÿ™", translit:"okht" },

      /* Extended family */
      { category:"Extended Family", front:"grandma", arabic:"ÿ≥ÿ™Ÿë", translit:"sett" },
      { category:"Extended Family", front:"grandpa", arabic:"ÿ¨ÿØ", translit:"jedd" },
      { category:"Extended Family", front:"my grandma", arabic:"ÿ≥Ÿêÿ™ŸëŸä / ÿ™Ÿäÿ™Ÿëÿß / ŸÜÿßŸÜÿß", translit:"setti / teeta / nana" },
      { category:"Extended Family", front:"my grandpa", arabic:"ÿ¨ÿØŸëŸä / ÿ¨ÿØŸà", translit:"jeddi / jeddo" },
      { category:"Extended Family", front:"grandson", arabic:"ÿ≠ŸÅŸäÿØ", translit:"hafeed" },
      { category:"Extended Family", front:"granddaughter", arabic:"ÿ≠ŸÅŸäÿØÿ©", translit:"hafeed√©" },
      { category:"Extended Family", front:"grandchildren", arabic:"ÿ£ÿ≠ŸÅÿßÿØ", translit:"ahfaad" },

      { category:"Extended Family", front:"nephew (brother‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿÆŸäŸë", translit:"ibn khayy" },
      { category:"Extended Family", front:"nephew (sister‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿ£ÿÆÿ™", translit:"ibn okht" },
      { category:"Extended Family", front:"niece (brother‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿÆŸäŸë", translit:"bent khayy" },
      { category:"Extended Family", front:"niece (sister‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿ£ÿÆÿ™", translit:"bent okht" },

      { category:"Extended Family", front:"paternal aunt", arabic:"ÿπŸÖŸëÿ©", translit:"3amme" },
      { category:"Extended Family", front:"paternal uncle", arabic:"ÿπŸÖŸë", translit:"3ammo" },
      { category:"Extended Family", front:"maternal aunt", arabic:"ÿÆÿßŸÑÿ©", translit:"khale" },
      { category:"Extended Family", front:"maternal uncle", arabic:"ÿÆÿßŸÑ", translit:"khaal" },
      { category:"Extended Family", front:"his aunt", arabic:"ÿÆÿßŸÑÿ™Ÿà", translit:"khaalto" },
      { category:"Extended Family", front:"his uncle", arabic:"ÿÆÿßŸÑŸà", translit:"khalo" },

      { category:"Extended Family", front:"cousin (paternal uncle‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿπŸÖŸë", translit:"ibn 3amm" },
      { category:"Extended Family", front:"cousin (paternal aunt‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿπŸÖŸëÿ©", translit:"ibn 3amme" },
      { category:"Extended Family", front:"cousin (maternal uncle‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿÆÿßŸÑ", translit:"ibn khaal" },
      { category:"Extended Family", front:"cousin (maternal aunt‚Äôs son)", arabic:"ÿßÿ®ŸÜ ÿÆÿßŸÑÿ©", translit:"ibn khale" },
      { category:"Extended Family", front:"cousin (paternal uncle‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿπŸÖŸë", translit:"bent 3amm" },
      { category:"Extended Family", front:"cousin (paternal aunt‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿπŸÖŸëÿ©", translit:"bent 3amme" },
      { category:"Extended Family", front:"cousin (maternal uncle‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿÆÿßŸÑ", translit:"bent khaal" },
      { category:"Extended Family", front:"cousin (maternal aunt‚Äôs daughter)", arabic:"ÿ®ŸÜÿ™ ÿÆÿßŸÑÿ©", translit:"bent khale" },

      { category:"Extended Family", front:"respectful older man", arabic:"ÿπŸÖŸëŸà", translit:"3ammo" },
      { category:"Extended Family", front:"respectful older woman", arabic:"ÿÆÿßŸÑÿ™Ÿà", translit:"khaalto" },
      { category:"Extended Family", front:"auntie (friendly)", arabic:"ÿ¢ŸÜŸíÿ™Ÿä", translit:"anti" },
      { category:"Extended Family", front:"older woman / elder woman", arabic:"ÿÆÿßŸÑÿ©", translit:"khale" },

      /* Verbs */
      { category:"Verbs (Actions)", front:"like / love", arabic:"ÿ≠ÿ®Ÿë", translit:"hebb" },
      { category:"Verbs (Actions)", front:"go", arabic:"ÿ±Ÿàÿ≠", translit:"rou·∏•" },
      { category:"Verbs (Actions)", front:"prefer", arabic:"ŸÅÿ∂ŸëŸÑ", translit:"fa·∏ç·∏çal" },
      { category:"Verbs (Actions)", front:"eat", arabic:"ÿ£ŸÉŸÑ", translit:"ekol" },
      { category:"Verbs (Actions)", front:"drink", arabic:"ÿ•ÿ¥ÿ±ÿ®", translit:"eshreb" },
      { category:"Verbs (Actions)", front:"travel", arabic:"ÿ≥ÿßŸÅÿ±", translit:"sƒÅfer" },
      { category:"Verbs (Actions)", front:"sleep", arabic:"ŸÜÿßŸÖ", translit:"nƒÅm" },

      /* Slang */
      { category:"Slang / Informal", front:"chill / relax", arabic:"ÿ±ŸàŸëŸÇ", translit:"rawwa º" },
      { category:"Slang / Informal", front:"twin", arabic:"ÿ™Ÿàÿ£ŸÖ", translit:"to ºam" }
    ];

    /* LETTER FORMS */
    const letters = [
      { letter:"ÿß", printed:"ÿß ŸÄÿß ŸÄÿß ÿß" },
      { letter:"ÿ®", printed:"ÿ® ÿ®ŸÄ ŸÄÿ®ŸÄ ŸÄÿ®" },
      { letter:"ÿ™", printed:"ÿ™ ÿ™ŸÄ ŸÄÿ™ŸÄ ŸÄÿ™" },
      { letter:"ÿ´", printed:"ÿ´ ÿ´ŸÄ ŸÄÿ´ŸÄ ŸÄÿ´" },
      { letter:"ÿ¨", printed:"ÿ¨ ÿ¨ŸÄ ŸÄÿ¨ŸÄ ŸÄÿ¨" },
      { letter:"ÿ≠", printed:"ÿ≠ ÿ≠ŸÄ ŸÄÿ≠ŸÄ ŸÄÿ≠" },
      { letter:"ÿÆ", printed:"ÿÆ ÿÆŸÄ ŸÄÿÆŸÄ ŸÄÿÆ" },
      { letter:"ÿØ", printed:"ÿØ ŸÄÿØ ŸÄÿØ ÿØ" },
      { letter:"ÿ∞", printed:"ÿ∞ ŸÄÿ∞ ŸÄÿ∞ ÿ∞" },
      { letter:"ÿ±", printed:"ÿ± ŸÄÿ± ŸÄÿ± ÿ±" },
      { letter:"ÿ≤", printed:"ÿ≤ ŸÄÿ≤ ŸÄÿ≤ ÿ≤" },
      { letter:"ÿ≥", printed:"ÿ≥ ÿ≥ŸÄ ŸÄÿ≥ŸÄ ŸÄÿ≥" },
      { letter:"ÿ¥", printed:"ÿ¥ ÿ¥ŸÄ ŸÄÿ¥ŸÄ ŸÄÿ¥" },
      { letter:"ÿµ", printed:"ÿµ ÿµŸÄ ŸÄÿµŸÄ ŸÄÿµ" },
      { letter:"ÿ∂", printed:"ÿ∂ ÿ∂ŸÄ ŸÄÿ∂ŸÄ ŸÄÿ∂" },
      { letter:"ÿ∑", printed:"ÿ∑ ÿ∑ŸÄ ŸÄÿ∑ŸÄ ŸÄÿ∑" },
      { letter:"ÿ∏", printed:"ÿ∏ ÿ∏ŸÄ ŸÄÿ∏ŸÄ ŸÄÿ∏" },
      { letter:"ÿπ", printed:"ÿπ ÿπŸÄ ŸÄÿπŸÄ ŸÄÿπ" },
      { letter:"ÿ∫", printed:"ÿ∫ ÿ∫ŸÄ ŸÄÿ∫ŸÄ ŸÄÿ∫" },
      { letter:"ŸÅ", printed:"ŸÅ ŸÅŸÄ ŸÄŸÅŸÄ ŸÄŸÅ" },
      { letter:"ŸÇ", printed:"ŸÇ ŸÇŸÄ ŸÄŸÇŸÄ ŸÄŸÇ" },
      { letter:"ŸÉ", printed:"ŸÉ ŸÉŸÄ ŸÄŸÉŸÄ ŸÄŸÉ" },
      { letter:"ŸÑ", printed:"ŸÑ ŸÑŸÄ ŸÄŸÑŸÄ ŸÄŸÑ" },
      { letter:"ŸÖ", printed:"ŸÖ ŸÖŸÄ ŸÄŸÖŸÄ ŸÄŸÖ" },
      { letter:"ŸÜ", printed:"ŸÜ ŸÜŸÄ ŸÄŸÜŸÄ ŸÄŸÜ" },
      { letter:"ŸáŸÄ", printed:"ŸáŸÄ ŸáŸÄ ŸÄŸáŸÄ ŸÄŸá" },
      { letter:"Ÿà", printed:"Ÿà ŸÄŸà ŸÄŸà Ÿà" },
      { letter:"Ÿä", printed:"Ÿä ŸäŸÄ ŸÄŸäŸÄ ŸÄŸä" }
    ];

    /* STATE */
    let known = JSON.parse(localStorage.getItem("known") || "[]");
    let index = 0;              // index within filteredIndices
    let showFront = true;
    let filteredIndices = [];
    let currentView = "cards";

    /* DOM REFS */
    const cardEl = document.getElementById("card");
    const contentEl = document.getElementById("card-content");
    const categoryEl = document.getElementById("category-pill");
    const sideLabelEl = document.getElementById("side-label");
    const knownPillEl = document.getElementById("known-pill");
    const counterEl = document.getElementById("counter");

    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const flipBtn = document.getElementById("flip-btn");
    const shuffleBtn = document.getElementById("shuffle-btn");
    const toggleKnownBtn = document.getElementById("toggle-known-btn");

    const cardsView = document.getElementById("cards-view");
    const listView = document.getElementById("list-view");
    const quizView = document.getElementById("quiz-view");
    const studyView = document.getElementById("study-tools-view");

    const tabCards = document.getElementById("tab-cards");
    const tabList = document.getElementById("tab-list");
    const tabQuiz = document.getElementById("tab-quiz");
    const tabStudy = document.getElementById("tab-study");

    const filterCategoryEl = document.getElementById("filter-category");
    const filterStatusEl = document.getElementById("filter-status");
    const filterSearchEl = document.getElementById("filter-search");

    const listCategoryFilter = document.getElementById("list-category-filter");
    const listBody = document.getElementById("list-body");
    const listSearch = document.getElementById("list-search");

    const quizPanel = document.getElementById("quiz-panel");
    const quizQuestion = document.getElementById("quiz-question");
    const quizOptions = document.getElementById("quiz-options");
    const quizProgress = document.getElementById("quiz-progress");
    const quizResult = document.getElementById("quiz-result");
    const startQuizBtn = document.getElementById("start-quiz-btn");
    const resetQuizBtn = document.getElementById("reset-quiz-btn");

    const lettersTableEl = document.getElementById("letters-table");
    const lettersView = document.getElementById("letters-view");
    const conjugationView = document.getElementById("conjugation-view");
    const subtabLetters = document.getElementById("subtab-letters");
    const subtabConjugation = document.getElementById("subtab-conjugation");

    const themeBtns = document.querySelectorAll(".theme-btn");
    const streakLabel = document.getElementById("streak-label");

    /* STREAK */
    function updateStreak() {
      const today = new Date().toISOString().slice(0,10);
      let data = JSON.parse(localStorage.getItem("streak-data") || "null");
      if (!data) {
        data = { last: today, count: 1 };
      } else {
        if (data.last !== today) {
          const lastDate = new Date(data.last);
          const diff = (new Date(today) - lastDate) / (1000*60*60*24);
          if (diff === 1) data.count += 1;
          else data.count = 1;
          data.last = today;
        }
      }
      localStorage.setItem("streak-data", JSON.stringify(data));
      streakLabel.textContent = `üî• ${data.count}-day streak`;
    }

    /* FILTERING */
    const categories = [...new Set(cards.map(c => c.category))].sort();
    filterCategoryEl.innerHTML =
      `<option value="All">All</option>` +
      categories.map(c => `<option value="${c}">${c}</option>`).join("");
    listCategoryFilter.innerHTML =
      `<option value="All">All</option>` +
      categories.map(c => `<option value="${c}">${c}</option>`).join("");

    function getActiveIndices() {
      return filteredIndices.length
        ? filteredIndices
        : cards.map((_, i) => i);
    }

    function recomputeFiltered() {
      const cat = filterCategoryEl.value;
      const status = filterStatusEl.value;
      const term = filterSearchEl.value.trim().toLowerCase();

      filteredIndices = cards
        .map((_, i) => i)
        .filter(i => {
          const c = cards[i];
          if (cat !== "All" && c.category !== cat) return false;
          if (status === "known" && !known.includes(i)) return false;
          if (status === "unknown" && known.includes(i)) return false;
          if (term && !c.front.toLowerCase().includes(term)) return false;
          return true;
        });

      const active = getActiveIndices();
      if (!active.length) index = 0;
      else if (index >= active.length) index = 0;

      render();
      if (currentView === "list") renderList();
    }

    filterCategoryEl.onchange = recomputeFiltered;
    filterStatusEl.onchange = recomputeFiltered;
    filterSearchEl.oninput = recomputeFiltered;

    /* RENDER CARD */
    function render() {
      const active = getActiveIndices();

      if (!active.length) {
        counterEl.textContent = `0 / ${cards.length}`;
        categoryEl.textContent = "No results";
        knownPillEl.style.display = "none";
        contentEl.innerHTML = `<div class="english" style="font-size:1.1rem;">No cards match the filters.</div>`;
        sideLabelEl.textContent = "Front ¬∑ EN";
        return;
      }

      if (index >= active.length) index = 0;
      const globalIdx = active[index];
      const card = cards[globalIdx];

      counterEl.textContent = `${index + 1} / ${active.length}`;
      categoryEl.textContent = card.category;

      const isKnown = known.includes(globalIdx);
      knownPillEl.style.display = isKnown ? "block" : "none";
      toggleKnownBtn.textContent = isKnown ? "Mark Unknown" : "Mark Known";

      contentEl.innerHTML = "";
      if (showFront) {
        sideLabelEl.textContent = "Front ¬∑ EN";
        const en = document.createElement("div");
        en.className = "english";
        en.textContent = card.front;
        contentEl.appendChild(en);
      } else {
        sideLabelEl.textContent = "Back ¬∑ AR";
        const ar = document.createElement("div");
        ar.className = "arabic";
        ar.textContent = card.arabic;
        const tr = document.createElement("div");
        tr.className = "translit";
        tr.textContent = card.translit;
        contentEl.appendChild(ar);
        contentEl.appendChild(tr);
      }
    }

    function goNext() {
      const active = getActiveIndices();
      if (!active.length) return;
      index = (index + 1) % active.length;
      showFront = true;
      render();
    }
    function goPrev() {
      const active = getActiveIndices();
      if (!active.length) return;
      index = (index - 1 + active.length) % active.length;
      showFront = true;
      render();
    }

    cardEl.onclick = (e) => {
      const rect = cardEl.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const third = rect.width / 3;
      if (x < third) {
        goPrev();
      } else if (x > 2*third) {
        goNext();
      } else {
        showFront = !showFront;
        render();
      }
    };

    nextBtn.onclick = goNext;
    prevBtn.onclick = goPrev;
    flipBtn.onclick = () => { showFront = !showFront; render(); };

    toggleKnownBtn.onclick = () => {
      const active = getActiveIndices();
      if (!active.length) return;
      const globalIdx = active[index];
      if (known.includes(globalIdx)) {
        known = known.filter(i => i !== globalIdx);
      } else {
        known.push(globalIdx);
      }
      localStorage.setItem("known", JSON.stringify(known));
      recomputeFiltered();
    };

    shuffleBtn.onclick = () => {
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      index = 0;
      showFront = true;
      recomputeFiltered();
    };

    /* LIST VIEW */
    function renderList() {
      const cat = listCategoryFilter.value;
      const term = listSearch.value.toLowerCase();
      listBody.innerHTML = "";

      cards
        .map((card, i) => ({ ...card, i }))
        .filter(c => cat === "All" || c.category === cat)
        .filter(c => c.front.toLowerCase().includes(term))
        .sort((a,b) => a.front.localeCompare(b.front))
        .forEach(item => {
          const div = document.createElement("div");
          div.className = "list-item";
          div.innerHTML = `
            <div class="list-row-main">
              <div>
                <div class="list-en">${item.front}</div>
                <div class="list-tr">${item.translit}</div>
              </div>
              <div class="list-ar">${item.arabic}</div>
            </div>
            <div class="list-meta">
              <span class="badge-category">${item.category}</span>
              ${known.includes(item.i) ? `<span class="badge-known">Known</span>` : ``}
            </div>
          `;
          div.onclick = () => {
            const activeAll = getActiveIndices();
            // jump to this index within overall array
            index = activeAll.indexOf(item.i);
            if (index === -1) index = 0;
            showFront = true;
            tabCards.click();
            render();
          };
          listBody.appendChild(div);
        });
    }

    listCategoryFilter.onchange = renderList;
    listSearch.oninput = renderList;

    /* QUIZ */
    let quizOrder = [];
    let quizIndex = 0;

    function startQuiz() {
      quizPanel.style.display = "flex";
      quizResult.textContent = "";
      quizOrder = [...Array(cards.length).keys()];
      quizOrder.sort(() => Math.random() - 0.5);
      quizOrder = quizOrder.slice(0, 10);
      quizIndex = 0;
      askQuestion();
    }

    function askQuestion() {
      if (quizIndex >= quizOrder.length) {
        quizQuestion.textContent = "Quiz complete!";
        quizOptions.innerHTML = "";
        quizProgress.textContent = "";
        return;
      }

      const idx = quizOrder[quizIndex];
      const c = cards[idx];
      quizQuestion.textContent = `Arabic for: ${c.front}`;
      quizProgress.textContent = `${quizIndex + 1} / ${quizOrder.length}`;

      const answers = [c.arabic];
      while (answers.length < 4 && answers.length < cards.length) {
        const r = cards[Math.floor(Math.random() * cards.length)].arabic;
        if (!answers.includes(r)) answers.push(r);
      }
      answers.sort(() => Math.random() - 0.5);

      quizOptions.innerHTML = "";
      answers.forEach(ans => {
        const btn = document.createElement("div");
        btn.className = "quiz-option";
        btn.textContent = ans;
        btn.onclick = () => {
          if (ans === c.arabic) {
            btn.classList.add("correct");
            setTimeout(() => {
              quizIndex++;
              askQuestion();
            }, 600);
          } else {
            btn.classList.add("wrong");
          }
        };
        quizOptions.appendChild(btn);
      });
    }

    startQuizBtn.onclick = startQuiz;
    resetQuizBtn.onclick = () => {
      quizPanel.style.display = "none";
      quizQuestion.textContent = "";
      quizOptions.innerHTML = "";
      quizProgress.textContent = "";
      quizResult.textContent = "";
    };

    /* TABS */
    function showView(view) {
      currentView = view;
      cardsView.style.display = view === "cards" ? "block" : "none";
      listView.style.display = view === "list" ? "block" : "none";
      quizView.style.display = view === "quiz" ? "block" : "none";
      studyView.style.display = view === "study" ? "flex" : "none";

      tabCards.classList.toggle("active", view === "cards");
      tabList.classList.toggle("active", view === "list");
      tabQuiz.classList.toggle("active", view === "quiz");
      tabStudy.classList.toggle("active", view === "study");

      if (view === "list") renderList();
    }

    tabCards.onclick = () => showView("cards");
    tabList.onclick = () => showView("list");
    tabQuiz.onclick = () => showView("quiz");
    tabStudy.onclick = () => showView("study");

    /* STUDY SUBTABS */
    function showSubView(which) {
      const isLetters = which === "letters";
      lettersView.style.display = isLetters ? "block" : "none";
      conjugationView.style.display = isLetters ? "none" : "block";
      subtabLetters.classList.toggle("active", isLetters);
      subtabConjugation.classList.toggle("active", !isLetters);
    }

    subtabLetters.onclick = () => showSubView("letters");
    subtabConjugation.onclick = () => showSubView("conjugation");

    /* LETTERS TABLE RENDER */
    function renderLettersTable() {
      lettersTableEl.innerHTML = `
        <thead>
          <tr>
            <th>Letter</th>
            <th>Isolated</th>
            <th>Initial</th>
            <th>Medial</th>
            <th>Final</th>
          </tr>
        </thead>
        <tbody>
          ${letters.map(l => {
            const [iso, init, med, fin] = l.printed.split(" ");
            return `
              <tr>
                <td class="letters-arabic">${l.letter}</td>
                <td class="letters-printed">${iso}</td>
                <td class="letters-printed">${init}</td>
                <td class="letters-printed">${med}</td>
                <td class="letters-printed">${fin}</td>
              </tr>
            `;
          }).join("")}
        </tbody>
      `;
    }

    /* THEMES */
    function applyTheme(t) {
      document.body.classList.remove("theme-minimal","theme-colorful","theme-dark");
      document.body.classList.add(`theme-${t}`);
      localStorage.setItem("app-theme", t);
      themeBtns.forEach(btn => {
        btn.classList.toggle("theme-active", btn.dataset.theme === t);
      });
    }

    themeBtns.forEach(btn => {
      btn.onclick = () => applyTheme(btn.dataset.theme);
    });

    const savedTheme = localStorage.getItem("app-theme") || "colorful";
    applyTheme(savedTheme);

    /* INIT */
    updateStreak();
    recomputeFiltered();
    showView("cards");
    showSubView("letters");
    renderLettersTable();
  </script>
</body>
</html>
